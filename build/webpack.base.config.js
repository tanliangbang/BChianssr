const path = require('path')
const vueConfig = require('./vue-loader.config')
const resolve = file => path.resolve(__dirname, file)

module.exports = {
  devtool: '#source-map',
  entry: {
    app: './src/client-entry.js',
    vendor: ['vue', 'vue-router', 'vuex', 'vuex-router-sync', 'axios', 'babel-polyfill']
  },
  resolve: {
    modules: [path.resolve(__dirname, 'src'), 'node_modules'],
    extensions: ['.js', '.vue'],
    alias: {
      'src': resolve('../src'),
      'util': resolve('../src/util'),
      'page': resolve('../src/page'),
      'static': resolve('../static'),
      'config': resolve('../config'),
      'components': resolve('../src/components')
    }
  },

  output: {
    path: resolve('../output'),
    publicPath: '/output/',
    filename: 'client-bundle.[chunkhash].js'
  },

  module: {
    rules: [{
      enforce: 'pre',
      test: /\.js$/,
      loader: 'eslint-loader',
      exclude: /node_modules/
    },
    {
      enforce: 'pre',
      test: /\.vue$/,
      loader: 'eslint-loader',
      exclude: /node_modules/
    },
    {
      test: /\.vue$/,
      loader: 'vue-loader',
      options: vueConfig
    },
    {
      test: /\.js$/,
      loader: 'babel-loader',
      exclude: /node_modules/,
      query: {
        presets: ['es2015']
      }
    },
    {
      test: /\.(png|jpg|gif|svg)$/,
      loader: 'file-loader',
      options: {
        name: '[name].[ext]?[hash]'
      }
    },
    {
      test: /\.(woff2?|eot|ttf|otf)(\?.*)?$/,
      loader: 'url-loader'
    }
    ]
  }
}
